@{
    Layout = "~/Views/Shared/_WebpackLayout.cshtml";
    Html.SetPageTitles("Receive Dehydrated Material", "Inventory", "Dehydrated Material");
}

@section controlPanel {
  <fieldset>
    <form class="input-group" data-bind="submit: search">
      <input class="form-control" data-bind="value: searchKey.formattedLot, valueUpdate: 'input'" type="search" placeholder="Go to lot..." tabindex="-1" />
      <span class="input-group-btn">
        <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
      </span>
    </form>
  </fieldset>

  <fieldset>
    <legend>Lot Controls</legend>
    <div data-bind="visible: !selectedKey()">
      <input data-bind="command: receiveNew" type="button" value="Receive New" tabindex="-1"/>
      <input data-bind="command: loadNextPageCommand" type="button" value="Get More Lots" tabindex="-1"/>
    </div>
    <div data-bind="if: selectedKey">
      <div data-bind="visible: !isEditing()">
        <input class="button" type="button" value="Edit" data-bind="command: editCommand" tabindex="-1">
        <input type="button" value="Close" data-bind="command: closePopupCommand, visible: !isEditing()" tabindex="-1" />
      </div>
      <div data-bind="visible: isEditing">
        <input class="save" type="button" value="Save" data-bind="command: saveCommand" tabindex="-1"/>
        <input class="delete" type="button" value="Cancel" data-bind="command: cancelEditCommand" tabindex="-1"/>
      </div>
    </div>

    <!-- ko if: isInit() && isEditing() -->
    <fieldset>
      <legend>Editing</legend>
      <input type="button" value="Add Material" data-bind="command: addDetailsItemCommand" tabindex="100"/>
      <input type="button" value="Add Variety" data-bind="command: newVariety" tabindex="-1"/>
    </fieldset>
    <!-- /ko -->

    <fieldset data-bind="visible: isAddingVariety">
      <legend>New Variety</legend>
      <input class="form-control" type="text" data-bind="value: newVarietyName, valueUpdate: 'input'" placeholder="New Variety Name">
      <input type="button" value="Save Variety" data-bind="command: saveNewVariety">
      <input type="button" value="Cancel" data-bind="command: cancelNewVariety">
    </fieldset>
  </fieldset>
  <fieldset>
    <legend>Recent Entries</legend>
    <ul class="link-list" data-bind="foreach: recentEntries, click: recentEntryClicked">
      <li><a href="#" data-bind="text: $data" tabindex="-1"></a></li>
    </ul>
  </fieldset>
}

@* Main view *@
<dehydrated-materials-summary params="getItem: getItem,
            exports: summaryExports">
</dehydrated-materials-summary>

<div data-bind="popup: selectedKey, closePopupCommand: closePopupCommand">
  <dehydrated-materials-details params="key: selectedKey,
                exports: detailsExports,
                input: detailsInput,
                isEditing: isEditing">
  </dehydrated-materials-details>
</div>

@section scripts {
  <script src="~/App/build/dehydratedMaterials.bundle.js?v=@Html.AppVersion()"></script>
}
