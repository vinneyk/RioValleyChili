
@{
    ViewBag.Title = "Sample Matching";
    Layout = "~/Views/Shared/_WebpackLayout.cshtml";
}

@section controlPanel
{
<!-- ko if: isInit -->
<form data-bind="submit: searchForKey.execute">
    <fieldset>
        <legend>Navigation</legend>
            <div class="input-group">
                <input type="search" class="form-control" data-bind="textinput: searchKey" placeholder="Sample number...">
                <div class="input-group-btn">
                    <button class="btn btn-default" data-bind="command: searchForKey"><i class="fa fa-search"></i></button>
                </div>
            </div>
    </fieldset>
</form>

<fieldset data-bind="visible: !isNew()">
    <legend>Sample Matching Tools</legend>
    <input type="button" value="Start New Request" data-bind="command: startNewSampleRequest">
</fieldset>
<fieldset data-bind="visible: !editorData.input()">
    <legend>Filters</legend>
    <input type="button" value="Load More" data-bind="command: loadMoreSamples">
    <ul class="list-unstyled">
        <li>
            <label class="control-label">Date Received</label>
            <div class="form-group">
                <input type="text" class="form-control" data-bind="datePicker: filters.startDateReceivedFilter" placeholder="Start date...">
            </div>
            <div class="form-group">
                <input type="text" class="form-control" data-bind="datePicker: filters.endDateReceivedFilter" placeholder="End date...">
            </div>
        </li>
        <li>
            <label class="control-label">Date Completed</label>
            <div class="form-group">
                <input type="text" class="form-control" data-bind="datePicker: filters.startDateCompletedFilter" placeholder="Start date...">
            </div>
            <div class="form-group">
                <input type="text" class="form-control" data-bind="datePicker: filters.endDateCompletedFilter" placeholder="End date...">
            </div>
        </li>
        <li>
            <div class="form-group">
                <label class="control-label">Company</label>
                <select class="form-control" data-bind="value: filters.requestedCompanyKey, options: options.companies, optionsText: 'Name', optionsValue: 'CompanyKey', optionsCaption: ' '">
                </select>
            </div>
        </li>
        <li>
            <div class="form-group">
                <label class="control-label">Broker</label>
                <select class="form-control" data-bind="value: filters.brokerKey, options: options.brokers, optionsText: 'Name', optionsValue: 'CompanyKey', optionsCaption: ' '"></select>
            </div>
        </li>
        <li>
            <div class="form-group">
                <label>Status</label>
                <select class="form-control input-sm" data-bind="value: filters.status, options: options.sampleStatuses, optionsValue: 'key', optionsText: 'value', optionsCaption: ' '"></select>
            </div>
        </li>
    </ul>
</fieldset>

  <div data-bind="visible: editorData.input() && !isEditorPicking()">
    <fieldset >
      <legend>Editor Controls</legend>
      <input type="button" class="save" value="Save" data-bind="command: saveSample">
      <input type="button" class="delete" value="Delete" data-bind="command: deleteSample">
      <input type="button" value="Close" data-bind="command: closeEditorCommand">
    </fieldset>

    <fieldset>
      <legend><i class="fa fa-clipboard"></i> Reports</legend>
      <a href="{{ editorData.sampleRequestReportUrl() }}" class="button">Print Sample Request</a>
    </fieldset>
  </div>

<fieldset data-bind="visible: editorData.input() && isEditorPicking()">
    <legend>Contact Picker</legend>
    <input type="button" value="Close" data-bind="command: closePickerCommand">
</fieldset>
<!-- /ko -->
}

<section>
    <div class="modal" id="newProductModal" tabindex="-1" role="dialog" data-backdrop="static">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Create new product</h4>
                </div>
                <div class="modal-body" data-bind="if: newProductData.input">
                    <product-maintenance-editor
                        params="input: newProductData.input,
                            exports: newProductData.exports">
                    </product-maintenance-editor>
                </div>
                <div class="modal-footer text-right">
                    <button class="btn btn-default" data-bind="command: closeNewProductModal">Cancel</button>
                    <button class="btn btn-primary" data-bind="command: saveNewProduct">Save</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</section>

<section data-bind="popup: editorData.input, closePopupCommand: closeEditorCommand, if: editorData.input">
    <div data-bind="with: editorData">
        <hgroup>
            <h2>Sample Matching Editor</h2>
            <h3 data-bind="text: input().SampleRequestKey || 'New'"></h3>
        </hgroup>

        <sample-matching-editor
            params="input: input,
                options: options,
                callbacks: callbacks,
                exports: exports">
        </sample-matching-editor>
    </div>
</section>
<section>
    <div class="container-fluid">
        <h2>Sample Matching</h2>

        <!-- ko ifnot: isInit -->
        <section>
            <div class="well text-center">
                <i class="fa fa-spinner fa-pulse fa-3x"></i>
            </div>
        </section>
        <!-- /ko -->
        <!-- ko if: isInit -->
        <section data-bind="with: summaryData">
            <sample-matching-summary
                params="input: input,
                    selected: selected,
                    exports: exports">
            </sample-matching-summary>
        </section>
        <!-- /ko -->
    </div>
</section>

@section scripts
{
    <script src="~/App/build/sampleMatching.bundle.js?v=@Html.AppVersion()"></script>
}
